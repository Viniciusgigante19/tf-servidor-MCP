import{j as t}from"./app.js";import{r as a}from"./index.js";const j="wss://unifaat.luantavares.com/websocket";function v({onOpen:o,onClose:r,onError:d,onMessage:c}={}){const u=a.useRef(null),[m,i]=a.useState(()=>typeof window>"u"||typeof WebSocket>"u"?"unavailable":"connecting"),[f,p]=a.useState(null);a.useEffect(()=>{if(typeof window>"u"||typeof WebSocket>"u"){i("unavailable");return}const s=new WebSocket(j);return u.current=s,i("connecting"),s.onopen=()=>{i("open"),o?.()},s.onmessage=n=>{p(n.data),c?.(n)},s.onerror=n=>{d?.(n)},s.onclose=()=>{i("closed"),r?.()},()=>{(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING)&&s.close()}},[o,r,d,c]);const b=a.useCallback(s=>{const n=u.current;if(!n||n.readyState!==WebSocket.OPEN){console.warn("WebSocket nÃ£o estÃ¡ aberto. Mensagem nÃ£o enviada:",s);return}n.send(s)},[]),x=a.useCallback(()=>{const s=u.current;s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING)&&s.close()},[]);return{status:m,lastMessage:f,sendMessage:b,disconnect:x}}function k(o){return o==="open"?"Conectado":o==="connecting"?"Conectando...":o==="closed"?"Desconectado":"IndisponÃ­vel"}function w(){const{status:o,lastMessage:r,sendMessage:d}=v(),[c,u]=a.useState(""),[m,i]=a.useState(!1),[f,p]=a.useState(""),[b,x]=a.useState([]),s=a.useRef(null),n=e=>{x(l=>[...l,{id:Date.now(),...e}])};a.useEffect(()=>{if(r)try{const e=JSON.parse(r);if(e.type==="system"){n({text:e.text,self:!1,from:null,type:"system"});return}if(e.type==="message"){n({text:e.text,self:e.name===c,from:e.name,type:"message"});return}n({text:String(r),self:!1,from:null,type:"system"})}catch{n({text:r,self:!1,from:null,type:"system"})}},[r,c]),a.useEffect(()=>{s.current&&s.current.scrollIntoView({behavior:"smooth",block:"end"})},[b]);const h=e=>{e.preventDefault();const l=c.trim();l&&(i(!0),d?.(JSON.stringify({type:"join",name:l})))},y=e=>{const l=e.trim();!l||!m||d?.(JSON.stringify({type:"message",name:c,text:l}))},g=e=>{e.preventDefault(),y(f),p("")},N=["ðŸ”¥","ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ—¿","ðŸ’£","âœ…","ðŸ‘€"],S=o==="open"&&m;return t.jsx("div",{className:"row justify-content-center",children:t.jsxs("div",{className:"col-12 col-md-8 col-lg-6",children:[t.jsxs("p",{className:"mb-2",children:[t.jsx("strong",{children:"Status WebSocket:"})," ",k(o)," (",t.jsx("code",{children:"ws://localhost:8081"}),")"]}),m?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-3 border rounded p-2",style:{maxHeight:320,overflowY:"auto"},children:[b.length===0&&t.jsx("p",{className:"text-muted text-center my-2",children:"Nenhuma mensagem ainda."}),b.map(e=>t.jsx("div",{className:"d-flex mb-2 "+(e.self?"justify-content-end":"justify-content-start"),children:t.jsxs("div",{className:"px-3 py-2 rounded-3 "+(e.type==="system"?"bg-light text-muted":e.self?"bg-primary text-white":"bg-white border"),children:[t.jsx("div",{className:"small fw-semibold mb-1",children:e.type==="system"?"Sistema":e.self?"VocÃª":e.from??"UsuÃ¡rio"}),t.jsx("div",{className:"small",children:e.text})]})},e.id)),t.jsx("div",{ref:s})]}),t.jsx("div",{className:"d-flex flex-wrap gap-2 mb-2",children:N.map(e=>t.jsx("button",{type:"button",className:"btn btn-outline-secondary",disabled:!S,onClick:()=>y(e),children:e},e))}),t.jsxs("form",{onSubmit:g,className:"d-flex gap-2",children:[t.jsx("input",{className:"form-control",value:f,onChange:e=>p(e.target.value),placeholder:"Digite uma mensagem..."}),t.jsx("button",{type:"submit",className:"btn btn-success",disabled:!f.trim()||o!=="open",children:"Enviar"})]})]}):t.jsxs("form",{onSubmit:h,className:"mb-3",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Seu nome"}),t.jsx("input",{className:"form-control",value:c,onChange:e=>u(e.target.value),placeholder:"Digite seu nome"})]}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!c.trim()||o!=="open",children:"Entrar no chat"})]})]})})}function W(){return t.jsx("div",{className:"row g-4",children:t.jsx(w,{})})}export{W as default};
