import{j as t}from"./app.js";import{r as c}from"./index.js";const g="wss://unifaat.luantavares.com/websocket";function v({onOpen:n,onClose:o,onError:r,onMessage:l}={}){const u=c.useRef(null),[m,d]=c.useState(()=>typeof window>"u"||typeof WebSocket>"u"?"unavailable":"connecting"),[f,x]=c.useState(null);c.useEffect(()=>{if(typeof window>"u"||typeof WebSocket>"u"){d("unavailable");return}const s=new WebSocket(g);return u.current=s,d("connecting"),s.onopen=()=>{d("open"),n==null||n()},s.onmessage=a=>{x(a.data),l==null||l(a)},s.onerror=a=>{r==null||r(a)},s.onclose=()=>{d("closed"),o==null||o()},()=>{(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING)&&s.close()}},[n,o,r,l]);const b=c.useCallback(s=>{const a=u.current;if(!a||a.readyState!==WebSocket.OPEN){console.warn("WebSocket nÃ£o estÃ¡ aberto. Mensagem nÃ£o enviada:",s);return}a.send(s)},[]),p=c.useCallback(()=>{const s=u.current;s&&(s.readyState===WebSocket.OPEN||s.readyState===WebSocket.CONNECTING)&&s.close()},[]);return{status:m,lastMessage:f,sendMessage:b,disconnect:p}}function k(n){return n==="open"?"Conectado":n==="connecting"?"Conectando...":n==="closed"?"Desconectado":"IndisponÃ­vel"}function w(){const{status:n,lastMessage:o,sendMessage:r}=v(),[l,u]=c.useState(""),[m,d]=c.useState(!1),[f,x]=c.useState(""),[b,p]=c.useState([]),s=c.useRef(null),a=e=>{p(i=>[...i,{id:Date.now(),...e}])};c.useEffect(()=>{if(o)try{const e=JSON.parse(o);if(e.type==="system"){a({text:e.text,self:!1,from:null,type:"system"});return}if(e.type==="message"){a({text:e.text,self:e.name===l,from:e.name,type:"message"});return}a({text:String(o),self:!1,from:null,type:"system"})}catch{a({text:o,self:!1,from:null,type:"system"})}},[o,l]),c.useEffect(()=>{s.current&&s.current.scrollIntoView({behavior:"smooth",block:"end"})},[b]);const h=e=>{e.preventDefault();const i=l.trim();i&&(d(!0),r==null||r(JSON.stringify({type:"join",name:i})))},y=e=>{const i=e.trim();!i||!m||r==null||r(JSON.stringify({type:"message",name:l,text:i}))},N=e=>{e.preventDefault(),y(f),x("")},S=["ðŸ”¥","ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ—¿","ðŸ’£","âœ…","ðŸ‘€"],j=n==="open"&&m;return t.jsx("div",{className:"row justify-content-center",children:t.jsxs("div",{className:"col-12 col-md-8 col-lg-6",children:[t.jsxs("p",{className:"mb-2",children:[t.jsx("strong",{children:"Status WebSocket:"})," ",k(n)," (",t.jsx("code",{children:"wss://unifaat.luantavares.com/websocket"}),")"]}),m?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-3 border rounded p-2",style:{maxHeight:320,overflowY:"auto"},children:[b.length===0&&t.jsx("p",{className:"text-muted text-center my-2",children:"Nenhuma mensagem ainda."}),b.map(e=>t.jsx("div",{className:"d-flex mb-2 "+(e.self?"justify-content-end":"justify-content-start"),children:t.jsxs("div",{className:"px-3 py-2 rounded-3 "+(e.type==="system"?"bg-light text-muted":e.self?"bg-primary text-white":"bg-white border"),children:[t.jsx("div",{className:"small fw-semibold mb-1",children:e.type==="system"?"Sistema":e.self?"VocÃª":e.from??"UsuÃ¡rio"}),t.jsx("div",{className:"small",children:e.text})]})},e.id)),t.jsx("div",{ref:s})]}),t.jsx("div",{className:"d-flex flex-wrap gap-2 mb-2",children:S.map(e=>t.jsx("button",{type:"button",className:"btn btn-outline-secondary",disabled:!j,onClick:()=>y(e),children:e},e))}),t.jsxs("form",{onSubmit:N,className:"d-flex gap-2",children:[t.jsx("input",{className:"form-control",value:f,onChange:e=>x(e.target.value),placeholder:"Digite uma mensagem..."}),t.jsx("button",{type:"submit",className:"btn btn-success",disabled:!f.trim()||n!=="open",children:"Enviar"})]})]}):t.jsxs("form",{onSubmit:h,className:"mb-3",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Seu nome"}),t.jsx("input",{className:"form-control",value:l,onChange:e=>u(e.target.value),placeholder:"Digite seu nome"})]}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!l.trim()||n!=="open",children:"Entrar no chat"})]})]})})}function C(){return t.jsx("div",{className:"row g-4",children:t.jsx(w,{})})}export{C as default};
