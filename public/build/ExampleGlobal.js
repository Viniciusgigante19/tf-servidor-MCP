import{j as e}from"./app.js";import{r as i}from"./index.js";import{f as g,a as j,B as b,p as N,P}from"./Button.js";import{b as v}from"./catchError.js";import"./index2.js";function w(){const[n,r]=i.useState(!1),[c,s]=i.useState(),[d,l]=i.useState(),a=()=>new Promise(t=>{setTimeout(()=>{t("")},200)});return{callProductListApi:async(t=0,u=15,p="id,desc")=>{r(!0);const h=new URLSearchParams({orderBy:p,limit:u.toString(),offset:t.toString()});await a();try{const{data:m}=await v.get(`api/products?${h}`);s(m),l(m.count)}catch{s("error")}finally{r(!1)}},loading:n,productList:c,total:d}}function y(n,r){return r.type==="changeProducts"?{...n,data:r.payload}:n}const x=i.createContext(null);function L({children:n}){const[r,c]=i.useReducer(y,{}),s=i.useMemo(()=>({state:r,changeData:d=>c({type:"changeProducts",payload:d})}),[r]);return e.jsx(x,{value:s,children:n})}function f(){const n=i.useContext(x);if(!n)throw new Error("useProducts deve ser usado dentro de <ProductsProvider>");return n}const I=i.forwardRef(function({onChange:r},c){const{state:s}=f(),d=typeof s.data=="object"?s.data.page:1,l=typeof s.data=="object"?s.data.totalPages:0,a=i.useMemo(()=>{const t=[];for(let u=1;u<=l;u++)t.push(u);return t},[l]),o=t=>()=>{r==null||r(t)};return e.jsx("div",{className:"pagination",children:e.jsx("ul",{className:"pagination justify-content-center",children:a.map(t=>e.jsx("li",{className:`page-item ${t===d?"active":""}`,children:e.jsx("button",{className:"page-link","aria-current":t===d?"page":void 0,onClick:o(t),children:t})},t))})})});function C({onDelete:n}){const{state:r}=f(),c=r.data,s=i.useRef(new Map),d=i.useCallback(a=>o=>{if(o){s.current.set(a,o);return}s.current.delete(a)},[]),l=a=>async()=>{var t,u;if((t=s.current.get(a))==null||t.disable(),await N(a)!==null){(u=s.current.get(a))==null||u.enable();return}n==null||n()};return c?c==="error"?e.jsx("div",{className:"alert alert-warning",children:"Erro na API."}):e.jsx("div",{children:c.rows.length===0?e.jsx("div",{className:"alert alert-warning",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"row row-cols-1 row-cols-md-2 g-4",children:c.rows.map(a=>{const o=a.id;return e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm rounded-4",children:[e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:a.name}),e.jsx("span",{className:"badge text-bg-light border",children:g(a.price_times_thousand)})]}),e.jsxs("p",{className:"card-text text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"fa-regular fa-clock me-1","aria-hidden":"true"}),"Cadastrado em ",j(a.created_at)]})]}),e.jsx("div",{className:"card-footer bg-white border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"badge rounded-pill text-bg-primary",children:["#",a.id]}),e.jsx(b,{ref:d(o),onClick:l(o),classList:"btn-danger",children:e.jsx("i",{className:"fa-solid fa-trash"})},o)]})})]})},o)})})}):e.jsxs("div",{className:"alert alert-light border d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Carregando produtos..."]})}const M=function(){const{loading:r,callProductListApi:c,productList:s}=w(),{changeData:d}=f();i.useEffect(()=>{d(s)},[s]),i.useEffect(()=>{c(0,10)},[]);const l=()=>{c(0,10)},a=()=>{c(0,10)},o=t=>{c((t-1)*10,10)};return e.jsxs("div",{className:"row g-4",children:[e.jsx(P,{onCreate:l}),e.jsx("div",{className:"col-12 col-lg-8",children:r?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs("div",{className:"d-flex gap-4 flex-column",children:[e.jsx(C,{onDelete:a}),e.jsx(I,{onChange:o})]})})]})},S=()=>e.jsx(L,{children:e.jsx(M,{})});export{S as default};
