import{j as e}from"./app.js";import{r as i}from"./index.js";import{f as g,a as j,B as b,p as N,P}from"./Button.js";import{b as v}from"./catchError.js";import"./index2.js";function w(){const[o,r]=i.useState(!1),[n,a]=i.useState(),[l,d]=i.useState(),t=()=>new Promise(s=>{setTimeout(()=>{s("")},200)});return{callProductListApi:async(s=0,u=15,h="id,desc")=>{r(!0);const p=new URLSearchParams({orderBy:h,limit:u.toString(),offset:s.toString()});await t();try{const{data:m}=await v.get(`api/products?${p}`);a(m),d(m.count)}catch{a("error")}finally{r(!1)}},loading:o,productList:n,total:l}}function y(o,r){return r.type==="changeProducts"?{...o,data:r.payload}:o}const x=i.createContext(null);function L({children:o}){const[r,n]=i.useReducer(y,{}),a=i.useMemo(()=>({state:r,changeData:l=>n({type:"changeProducts",payload:l})}),[r]);return e.jsx(x,{value:a,children:o})}function f(){const o=i.useContext(x);if(!o)throw new Error("useProducts deve ser usado dentro de <ProductsProvider>");return o}const C=i.forwardRef(function({onChange:r},n){const{state:a}=f(),l=typeof a.data=="object"?a.data.page:1,d=typeof a.data=="object"?a.data.totalPages:0,t=i.useMemo(()=>{const s=[];for(let u=1;u<=d;u++)s.push(u);return s},[d]),c=s=>()=>{r?.(s)};return e.jsx("div",{className:"pagination",children:e.jsx("ul",{className:"pagination justify-content-center",children:t.map(s=>e.jsx("li",{className:`page-item ${s===l?"active":""}`,children:e.jsx("button",{className:"page-link","aria-current":s===l?"page":void 0,onClick:c(s),children:s})},s))})})});function I({onDelete:o}){const{state:r}=f(),n=r.data,a=i.useRef(new Map),l=i.useCallback(t=>c=>{if(c){a.current.set(t,c);return}a.current.delete(t)},[]),d=t=>async()=>{if(a.current.get(t)?.disable(),await N(t)!==null){a.current.get(t)?.enable();return}o?.()};return n?n==="error"?e.jsx("div",{className:"alert alert-warning",children:"Erro na API."}):e.jsx("div",{children:n.rows.length===0?e.jsx("div",{className:"alert alert-warning",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"row row-cols-1 row-cols-md-2 g-4",children:n.rows.map(t=>{const c=t.id;return e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm rounded-4",children:[e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:t.name}),e.jsx("span",{className:"badge text-bg-light border",children:g(t.price_times_thousand)})]}),e.jsxs("p",{className:"card-text text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"fa-regular fa-clock me-1","aria-hidden":"true"}),"Cadastrado em ",j(t.created_at)]})]}),e.jsx("div",{className:"card-footer bg-white border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"badge rounded-pill text-bg-primary",children:["#",t.id]}),e.jsx(b,{ref:l(c),onClick:d(c),classList:"btn-danger",children:e.jsx("i",{className:"fa-solid fa-trash"})},c)]})})]})},c)})})}):e.jsxs("div",{className:"alert alert-light border d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Carregando produtos..."]})}const M=function(){const{loading:r,callProductListApi:n,productList:a}=w(),{changeData:l}=f();i.useEffect(()=>{l(a)},[a]),i.useEffect(()=>{n(0,10)},[]);const d=()=>{n(0,10)},t=()=>{n(0,10)},c=s=>{n((s-1)*10,10)};return e.jsxs("div",{className:"row g-4",children:[e.jsx(P,{onCreate:d}),e.jsx("div",{className:"col-12 col-lg-8",children:r?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs("div",{className:"d-flex gap-4 flex-column",children:[e.jsx(I,{onDelete:t}),e.jsx(C,{onChange:c})]})})]})},D=()=>e.jsx(L,{children:e.jsx(M,{})});export{D as default};
