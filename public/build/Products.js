import{j as e}from"./app.js";import{r as d}from"./index.js";import{f as m,a as u,B as f,p as x,P as h}from"./Button.js";import{b as p,c as j}from"./catchError.js";import"./index2.js";function b({products:a,onDelete:c}){const[t,n]=d.useState(a),i=d.useRef(new Map),o=d.useCallback(r=>s=>{if(s){i.current.set(r,s);return}i.current.delete(r)},[]);d.useEffect(()=>{n(a)},[a]);const l=r=>async()=>{if(i.current.get(r)?.disable(),await x(r)!==null){i.current.get(r)?.enable();return}c?.()};return t?t==="error"?e.jsx("div",{className:"alert alert-warning",children:"Erro na API."}):e.jsx("div",{children:t.rows.length===0?e.jsx("div",{className:"alert alert-warning",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"row row-cols-1 row-cols-md-2 g-4",children:t.rows.map(r=>{const s=r.id;return e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm rounded-4",children:[e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:r.name}),e.jsx("span",{className:"badge text-bg-light border",children:m(r.price_times_thousand)})]}),e.jsxs("p",{className:"card-text text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"fa-regular fa-clock me-1","aria-hidden":"true"}),"Cadastrado em ",u(r.created_at)]})]}),e.jsx("div",{className:"card-footer bg-white border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"badge rounded-pill text-bg-primary",children:["#",r.id]}),e.jsx(f,{ref:o(s),onClick:l(s),classList:"btn-danger",children:e.jsx("i",{className:"fa-solid fa-trash"})},s)]})})]})},s)})})}):e.jsxs("div",{className:"alert alert-light border d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Carregando produtos..."]})}async function g(a=15,c="id,desc"){const t=new URLSearchParams({orderBy:c,limit:a.toString()});try{const{data:n}=await p.get(`api/products?${t}`);return n}catch(n){return j(n)}}function C(){const[a,c]=d.useState();d.useEffect(()=>{t()},[]);const t=async()=>{const o=await g(10);if("error"in o)return c("error");c(o.rows)},n=()=>{t()},i=()=>{t()};return e.jsxs("div",{className:"row g-4",children:[e.jsx(h,{onCreate:n}),e.jsx(b,{products:a,onDelete:i})]})}export{C as default};
