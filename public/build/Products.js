import{j as e}from"./app.js";import{r as i}from"./index.js";import{f as p,a as j,B as f,p as g,P as b}from"./Button.js";import{b as w,c as N}from"./catchError.js";import"./index2.js";function P({products:t,onDelete:r}){var u;const[a,c]=i.useState(t??{rows:[],count:0,limit:10,page:1,next:null,totalPages:0}),o=i.useRef(new Map),x=i.useCallback(s=>n=>{if(n){o.current.set(s,n);return}o.current.delete(s)},[]);i.useEffect(()=>{t&&c(t)},[t]);const l=s=>async()=>{var m,h;if((m=o.current.get(s))==null||m.disable(),await g(s)!==null){(h=o.current.get(s))==null||h.enable();return}r==null||r()};return a?a==="error"?e.jsx("div",{className:"alert alert-warning",children:"Erro na API."}):e.jsx("div",{children:((u=a.rows)==null?void 0:u.length)===0?e.jsx("div",{className:"alert alert-warning",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"row row-cols-1 row-cols-md-2 g-4",children:a.rows.map(s=>{const n=s.id;return e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm rounded-4",children:[e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:s.name}),e.jsx("span",{className:"badge text-bg-light border",children:p(s.price_times_thousand)})]}),e.jsxs("p",{className:"card-text text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"fa-regular fa-clock me-1","aria-hidden":"true"}),"Cadastrado em ",j(s.created_at)]})]}),e.jsx("div",{className:"card-footer bg-white border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"badge rounded-pill text-bg-primary",children:["#",s.id]}),e.jsx(f,{ref:x(n),onClick:l(n),classList:"btn-danger",children:e.jsx("i",{className:"fa-solid fa-trash"})},n)]})})]})},n)})})}):e.jsxs("div",{className:"alert alert-light border d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Carregando produtos..."]})}function y({products:t}){return t==="error"?e.jsx("div",{className:"alert alert-danger",children:"Erro ao carregar produtos do MCP."}):!t.rows||t.rows.length===0?e.jsx("div",{className:"alert alert-info",children:"Nenhum produto encontrado no MCP."}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:"Lista de Produtos (MCP - somente visualização)"}),e.jsxs("div",{className:"card-body",children:[e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Preço"}),e.jsx("th",{children:"Criado em"})]})}),e.jsx("tbody",{children:t.rows.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.id}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.price_times_thousand/1e3}),e.jsx("td",{children:new Date(r.created_at).toLocaleDateString()})]},r.id))})]}),e.jsxs("p",{children:["Página ",t.page," de ",t.totalPages," — Total: ",t.count," produtos"]})]})]})}async function v(t=15,r="id,desc"){const a=new URLSearchParams({orderBy:r,limit:t.toString()});try{const{data:c}=await w.get(`api/products?${a}`);return c}catch(c){return N(c)}}const C="http://localhost:8080/mcp";async function L(t){try{const a=await(await fetch(C,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json, text/event-stream"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getProducts",params:{limit:t}})})).json();return console.log("Resposta MCP:",a),a.error?{error:!0}:a.result}catch{return{error:!0}}}function _(){const[t,r]=i.useState({rows:[],count:0,limit:10,page:1,next:null,totalPages:0}),[a,c]=i.useState({rows:[],count:0,limit:10,page:1,next:null,totalPages:0}),[o,x]=i.useState(!0),[l,u]=i.useState(!1);i.useEffect(()=>{s()},[]);const s=async()=>{const d=await v(10);if("error"in d)return r("error");r(d)},n=async()=>{const d=await L(10);if("error"in d)return c("error");c(d)},m=()=>{s(),n()},h=()=>{s(),n()};return e.jsxs("div",{className:"row g-4",children:[e.jsx(b,{onCreate:m}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>x(!o),children:o?"Ocultar lista":"Mostrar lista"}),e.jsx("button",{type:"button",className:"btn btn-info",onClick:()=>{u(!l),l||n()},children:l?"Ocultar lista MCP":"Mostrar lista MCP"}),o&&e.jsx(P,{products:t,onDelete:h}),l&&e.jsx(y,{products:a})]})}export{_ as default};
