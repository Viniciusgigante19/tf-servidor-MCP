import{j as e}from"./app.js";import{r as d}from"./index.js";import{f,a as x,B as h,p,P as j}from"./Button.js";import{b,c as g}from"./catchError.js";import"./index2.js";function w({products:n,onDelete:t}){const[s,c]=d.useState(n),i=d.useRef(new Map),o=d.useCallback(r=>a=>{if(a){i.current.set(r,a);return}i.current.delete(r)},[]);d.useEffect(()=>{c(n)},[n]),console.log("DATA RECEBIDA",s);const u=r=>async()=>{var l,m;if((l=i.current.get(r))==null||l.disable(),await p(r)!==null){(m=i.current.get(r))==null||m.enable();return}t==null||t()};return s?s==="error"?e.jsx("div",{className:"alert alert-warning",children:"Erro na API."}):e.jsx("div",{children:s.rows.length===0?e.jsx("div",{className:"alert alert-warning",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"row row-cols-1 row-cols-md-2 g-4",children:s.rows.map(r=>{const a=r.id;return e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm rounded-4",children:[e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:r.name}),e.jsx("span",{className:"badge text-bg-light border",children:f(r.price_times_thousand)})]}),e.jsxs("p",{className:"card-text text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"fa-regular fa-clock me-1","aria-hidden":"true"}),"Cadastrado em ",x(r.created_at)]})]}),e.jsx("div",{className:"card-footer bg-white border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"badge rounded-pill text-bg-primary",children:["#",r.id]}),e.jsx(h,{ref:o(a),onClick:u(a),classList:"btn-danger",children:e.jsx("i",{className:"fa-solid fa-trash"})},a)]})})]})},a)})})}):e.jsxs("div",{className:"alert alert-light border d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Carregando produtos..."]})}async function N(n=15,t="id,desc"){const s=new URLSearchParams({orderBy:t,limit:n.toString()});try{const{data:c}=await b.get(`api/products?${s}`);return c}catch(c){return g(c)}}function C(){const[n,t]=d.useState();d.useEffect(()=>{s()},[]);const s=async()=>{const o=await N(10);if("error"in o)return t("error");t(o.rows)},c=()=>{s()},i=()=>{s()};return e.jsxs("div",{className:"row g-4",children:[e.jsx(j,{onCreate:c}),e.jsx(w,{products:n,onDelete:i})]})}export{C as default};
